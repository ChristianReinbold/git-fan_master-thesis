

% Grundlegender Aufbau:
% Git-Equivalence beyond the ample cone kommt in das Preliminaries-Kapitel
% Noch in Erfahrung bringen: Sinn den MovingCones.


% Reference to algorithm describing the whole application
\label{algorithm:main}

\chapter{Concept of the algorithm}
\label{chap:algorithm}

In the following sections we are going to develop a mathematical and algorithmic framework that allows us to compute the GIT fan for the case of a torus acting on an affine variety. The concepts presented in this chapter base on \cite{gitfan_symmetry, gitfan}.

First, we describe the formal setup and introduce the notation being used in the upcoming chapters. In the second section we present an algorithm that is capable of identifying orbit cones. They play an important role in the theory since all GIT cones emerge from their intersections. Afterwards, we transform the problem of computing the GIT fan into the problem of traversing a graph and present a suitable algorithm. Third, we modify the previous algorithms such that symmetries of the affine variety may be exploited in order to reduce the problem size by a factor that relates to the size of the symmetry group. Finally, we give an counterexample that -- contrary to \cite{gitfan_symmetry} -- one cannot drop non-minimal orbit cones with respect to inclusion. For this reason, we leave out the minimisation process.

\section{The setup}

Let $\field$ be an algebraically closed field.
\index{K@$\field$}%
We consider an affine variety $X$ that is embedded into $\field^r$ such that $X$ is the vanishing locus of an monomial free ideal $\ideal\subseteq \field[x_1,\dots,x_r]\eqdef \field[\mathbf{x}]$.
\index{X@$X$}%
\index{a@$\ideal$}%
\index{r@$r$}%
Furthermore, we assume that $\ideal$ is homogeneous with respect to a $\integer^k$\=/grading such that the vectors 
$$q_i\defeq \deg(x_i)\in\integer^k\quad 1\leq i \leq r$$
form the columns of a matrix $Q\in\field^{k\times r}$ of rank $k$.
\index{k@$k$}%
\index{Q@$Q$}%
\index{qi@$q_i$}%
Hence, the coordinate ring $\faktor{\field[\mathbf{x}]}{\ideal}$ becomes a $\integer^k$\=/graded ring. We obtain an action of the $k$\=/dimensional algebraic torus $\spec(\field[q_1,\dots,q_r])\cong (\field^*)^k$ on $X$ given by
$$(\field^*)^k \times X \rightarrow X,\quad (t,P) \mapsto (t^{q_1}P_1,\dots,t^{q_r}P_r).$$
Every algebraic torus acting on $X$ may be realised in this way \todo{Referenz}.

\section{Computing orbit cones}

In this section we describe orbit cones by faces of the positive orthant $\mathbb{Q}_{\geq 0}^r$, which we denote by $\gamma$.
\index{gamma@$\gamma$}%
From a combinatorial point of view these faces are subsets of $\{1,\dots,r\}$ such that whenever $e_i$ is a ray of a face, $i$ is located in the corresponding subset. A face $\gamma_0 \preceq \gamma$ defines a restriction $z_{\gamma_0}$ of any $r$\=/tuple of objects $z=(z_1,\dots,z_r)$ by setting
$$(z_{\gamma_0})_i =
\begin{cases}
z_i, & e_i\in\gamma_0 \\
0, & \text{else}
\end{cases}\quad 1\leq i \leq r.$$
We write $\ideal_{\gamma_0}$ for the ideal in $\field[\mathbf{x}_{\gamma_0}]$ that is obtained by sending all $x_i$ in $\ideal$ with $x_i\notin\gamma_0$ to zero.
\index{agamma0@$\ideal_{\gamma_0}$}%
Additionally, we define
$$\T_{\gamma_0} \defeq (\field^*)^r \cdot (1,\dots,1)_{\gamma_0},$$
which is the torus corresponding to $\gamma_0$.
\index{Tgamma0@$\T_{\gamma_0}$}%

\begin{defi}[\aface]
	A face $\gamma_0\preceq\gamma$ is called \emph{\aface{}} iff $X\cap \T_{\gamma_0} \neq \emptyset$.
	\index{aface@\aface}%
\end{defi}

\begin{prop}
	\label{prop:aface_orbit_cone_correspondence}
	The set
	$$\Omega_\ideal \defeq \left\{Q(\gamma_0)\ |\ \gamma_0\preceq\gamma \text{ is an } \ideal\text{\=/face}\right\}$$
	equals the collection of orbit cones as in \todo{Referenz auf Preliminaries}.
	\index{Oa@$\Omega_\ideal$}%
\end{prop}
\begin{proof}
	Let $x\in X$. Set $I_x = \{1 \leq i \leq r\ |\ x_i \neq 0\}$ and $J_x = \{1 \leq i \leq r\ |\ x_i = 0\}$. We claim that
	$$S_{(\field^*)^k}(x) = \langle q_i\ |\ i\in I_x\rangle,$$
	where $S_{(\field^*)^k}(x)$ is the orbit monoid of $x$ as in \todo{Referenz auf Preliminaries}.
	
	Let $i\in I_x$. Since $x_i\in\field[\mathbf{x}]$ does not send $x$ to zero, we have
	$$q_i = \deg(x_i)\in S_{(\field^*)^k}(x).$$
	Now let $w\in S_{(\field^*)^k}(x)$. Then there exists $f\in\field[\mathbf{x}]_w$ such that $f(x) \neq 0$. In particular, at least one monomial $\mathbf{x}^\alpha$ of $f$ does not send $x$ to zero, thus $\alpha_j = 0$ for all $j\in J_x$. On that account we have
	$$w = \deg(x^\alpha) = \sum_{i=1}^r \alpha_i q_i = \sum_{i\in I_x} \alpha_i q_i,$$
	proving the claim.
	
	If $\gamma_0\preceq\gamma$ is an \aface{}, we find a point $x\in X\cap \T_{\gamma_0}$. By the previous claim, its orbit monoid is generated by the columns $q_i$ of $Q$ with $e_i\in\gamma_0$. Consequently, $Q(\gamma_0)$ is the orbit cone of $x$ generated by $S_{(\field^*)^k}(x)$.
	
	Conversely, consider the orbit cone of an arbitrary point $x\in X$. Let $\gamma_x$ be the face of $\gamma$ that is generated by the rays $e_i$ with $i\in I_x$. Then $\gamma_x$ is an \aface{}, since $x\in X\cap \T_{\gamma_x}$. With the same arguments as before, it follows that $Q(\gamma_x)$ is the orbit cone of $x$.
\end{proof}

The previous proposition shows that all orbit cones arise from \afaces{} and that every \aface{} yields an orbit cone. Thus, if we are able to develop computable criteria in order to implement a test for the \aface{} property, we can derive all orbit cones by applying $Q$. The next proposition provides us with a suitable criterion.

\begin{prop}
	\label{prop:aface_equivalence}
	Let $\gamma_0\preceq\gamma$ be a face and $I= \{1\leq i\leq r\ |\ e_i\in\gamma_0\}$. Then the following conditions are equivalent:
	\begin{enumerate}[label={\upshape(\roman*)}]
		\item $\gamma_0$ is an \aface{}, that is $X\cap \T_{\gamma_0} \neq \emptyset$,
		\label{enum_item:aface_equivalence_aface}
		\item $\ideal_{\gamma_0}$ does not contain a monomial,
		\label{enum_item:aface_equivalence_monomial}
		\item $(\ideal_{\gamma_0} : (\prod_{i\in I} x_i)^\infty) = \field[\mathbf{x}_{\gamma_0}]$.
		\label{enum_item:aface_equivalence_saturation}
	\end{enumerate}
\end{prop}
\begin{proof}
	\ref{enum_item:aface_equivalence_monomial} $\Leftrightarrow$ \ref{enum_item:aface_equivalence_saturation} immediately follows from the definition of saturated ideals (see Appendix~\ref{appendix:ideal_quotients}), which unravels to
	$$\left(\ideal_{\gamma_0} : \left(\prod_{i\in I} x_i\right)^\infty\right) = \left\{r\in \field[\mathbf{x}]\ \middle|\ \exists j\in\natural: r\cdot \left(\prod_{i\in I} x_i\right)^j \in \ideal_{\gamma_0}\right\}.$$
	If $\ideal_{\gamma_0}$ contains a monomial $x^\alpha$, we have that $(\prod_{i\in I} x_i)^j\in\ideal_{\gamma_0}$, where $j$ is the largest integer occurring in $\alpha$. Thus, $1\in (\ideal_{\gamma_0} : (\prod_{i\in I} x_i)^\infty)$ and therefore \ref{enum_item:aface_equivalence_saturation} follows. Otherwise, if \ref{enum_item:aface_equivalence_saturation} holds, a power of $\prod_{i\in I} x_i$, which is a monomial, is contained in $\ideal_{\gamma_0}$.
	
	\ref{enum_item:aface_equivalence_aface} $\Rightarrow$ 
	\ref{enum_item:aface_equivalence_monomial}: Choose a point $x\in X\cap \T_{\gamma_0}$. Assume that \ref{enum_item:aface_equivalence_monomial} does not hold, i.e. $\ideal_{\gamma_0}$ contains a monomial $\mathbf{x}^\alpha$, $\alpha = (\alpha_i)_{i\in I}$, that is obtained by sending all $x_i$, $i\notin I$, in a suitable $f\in\ideal$ to zero.
	Since $x\in\T_{\gamma_0}$, it holds that
	$$f(x) = \prod_{i\in I} x_i^{\alpha_i} \neq 0,$$
	contradicting $x\in X = V(\ideal)$.
	
	\ref{enum_item:aface_equivalence_monomial} $\Rightarrow$ 
	\ref{enum_item:aface_equivalence_aface}: Assume that $V(\ideal_{\gamma_0}) \subseteq V(\prod_{i\in I} x_i)$ holds. Then Hilbert's Nullstellensatz yields a $j\in\natural$ such that $(\prod_{i\in I} x_i)^j\in\ideal_{\gamma_0}$, contradicting \ref{enum_item:aface_equivalence_monomial}. Hence, $V(\ideal_{\gamma_0}) \not\subseteq V(\prod_{i\in I} x_i)$. In particular, we find a point $z = (z_i)_{i\in I} \subseteq \field^*$ with $z\in V(\ideal_{\gamma_0})$. We extend $z$ to a point $\tilde{z}\in\T_{\gamma_0}$ by setting
	$$\tilde{z}_i = \begin{cases}
	z_i, & i\in I \\
	0, & \text{else}
	\end{cases}\quad 1\leq i \leq r.$$
	
	Let $f\in\ideal$ and $f_{\gamma_0}\in\ideal_{\gamma_0}$ be the reduction of $f$ by sending all variables $x_i$, $i\notin I$, to zero. Then we have
	$$f(\tilde{z}) = f_{\gamma_0}(z) = 0,$$
	since $z\in V(\ideal_{\gamma_0})$. We conclude that $\tilde{z}\in X$, showing \ref{enum_item:aface_equivalence_aface}.
\end{proof}

Next, we implement an algorithm computing $(I : (z_1\cdots z_n)^\infty)$ for arbitrary ideals $I\in\field[z_1,\dots,z_n]$. The algorithm presented here originates from \cite{gitfan_symmetry} and has been implemented in \gitfanlib. It relies on the following proposition that allows us to compute $(I : (z_i)^\infty)$ with relative ease by a small modification to the Buchberger's algorithm.

\begin{prop}[\phantom{}{\cite[Proposition 3.1]{gitfan_symmetry}}]
	\label{proposition:saturated_monomial}
	Let $\;>$ be a monomial ordering on $\field[\mathbf{z}]$ and $\mathcal{G}$ be a standard basis of $I$ with respect to $\;>$. Let $m\in\{1,\dots,n\}$. If $\;>$ satisfies
	\begin{equation}
		\label{equation:saturated_monomial_assumption}
		z_m \mid f\ \Leftrightarrow\ z_m \mid \text{LM}_>(f),
	\end{equation}
	then
	$$\left\{g\in\field[\mathbf{z}]\ \middle|\ z_m \centernot\mid g\ \mathrm{and}\ \exists i\in\natural: (z_m)^i \cdot g \in \mathcal{G}\right\}$$
	is a standard basis for the saturated ideal $I : (z_m)^\infty$. 
\end{prop}

\begin{remark}
	\label{remark:satisying_assumption_saturated_monomial}
	The negative reverse lexicographical ordering
	$$z^\alpha >_\text{rs} z^\beta\ \defequiv\ \exists i\in\{1,\dots,n\}: \alpha_i < \beta_i\ \text{and}\ \alpha_j = \beta_j\ \forall j\in\{i+1,\dots,n\}$$
	ensures that (\ref{equation:saturated_monomial_assumption}) is satisfied for $m=n$. Every monomial $z^\beta$ with $z_n \mid z^\beta$ is strictly smaller than any monomial $z^\alpha$ with $z_n \centernot\mid z^\alpha$, since $\alpha_n = 0 < \beta_n$. Note that (\ref{equation:saturated_monomial_assumption}) may hold for other values for $m$ by using a negative reverse lexicographical ordering after reordering the variables $z_1,\dots,z_n$.
	
	Unfortunately, $\;>_\text{rs}$ is no global ordering. However, if $I$ permits a weight vector $w\in\integer^n_{>0}$ such that $I$ is homogeneous, we consider the $w$\=/weighted degree ordering with tie-breaker $\;>_\text{rs}$, that is $(>_w, >_\text{rs})$. This ordering is global and satisfies (\ref{equation:saturated_monomial_assumption}) on $w$\=/homogeneous generators of $I$.
\end{remark}

Since we have
$$(I:(z_1\cdots z_n)^\infty) = (\dots((I:(z_1)^\infty):(z_2)^\infty):\dots : (z_n)^\infty)\quad\text{(see Appendix \ref{appendix:ideal_quotients})}$$
Proposition~\ref{proposition:saturated_monomial} allows us to compute $(I : (z_1\cdots z_n)^\infty)$ by alternating Mora's algorithm with $>_\text{rs}$ and the elimination of factors $z_i$. If a global ordering as in Remark~\ref{remark:satisying_assumption_saturated_monomial} is available, one can integrate the elimination process into the Buchberger's algorithm in order to speed up convergence. Algorithm~\ref{algo:saturated_monomial} (see also \cite[Algorithm 3.3]{gitfan_symmetry}) contains the necessary modifications.

\begin{algorithm}
	\caption{Computing the saturation at the product of all variables}
	\label{algo:saturated_monomial}
	
	\KwIn{A vector $w\in\integer^n_{>0}$ and a set $\mathcal{G}$ of $w$-homogenous polynomials such that $\langle \mathcal{G}\rangle = I$}
	\KwOut{A Gröbner basis for the saturation $(I:(z_1\cdots z_n)^\infty)$ with respect to the ordering $(>_w, >_\text{rs})$}
	\BlankLine
	$\mathcal{G} \leftarrow \{g / z^\alpha\ |\ g\in \mathcal{G}\ \text{and}\ \alpha\ \text{maximal such that}\ z^\alpha \mid g\}$\;
	\label{algo_line:saturated_monomial_preprocess_G}
	\For{$m=1,\dots,n$}{
		Let $\;>_m$ be $(>_w, >_\text{rs})$ where $\;>_\text{rs}$ is the negative reverse lexicographical ordering after reordering variables such that
		$$z_1 >_\text{rs} \dots >_\text{rs} z_{m-1} >_\text{rs} z_{m+1} >_\text{rs} \dots >_\text{rs} z_n >_\text{rs} z_m.$$
		
		\Repeat{$\mathcal{G} = \mathcal{H}$\label{algo_line:saturated_monomial_repeat_condition}}{
			$\mathcal{H} \leftarrow \mathcal{G}$\;
			\For{$f,g\in\mathcal{H}$}{
				$r \leftarrow \text{NF}_{>_m} (\text{spoly}_{>_m}(f,g),\mathcal{H})$\;
				\If{$r \neq 0$}{
					$r \leftarrow r / z^\alpha,\ \text{where}\ \alpha\ \text{is maximal such that}\ z^\alpha \mid g$\;
					$\mathcal{G} \leftarrow \mathcal{G} \cup \{r\}$\;
				}
			}
		}
	}
	\Return $\mathcal{G}$\;
\end{algorithm}

\begin{proof}
	Similarly to the Buchberger's algorithm, whenever a new element $r$ is introduced to $\mathcal{G}$, its lead monomial $\text{LM}(r)$ is not contained in the lead ideal of $\langle \mathcal{G} \rangle$. Consequently, $\langle \mathcal{G} \rangle$ strictly increases. Since $\field[\mathbf{z}]$ is noetherian, eventually $\langle \mathcal{G} \rangle$ becomes stationary, implying that no new elements $r$ have been inserted. Hence, the condition in Line~\ref{algo_line:saturated_monomial_repeat_condition} holds eventually and the algorithm terminates.
	
	Denote by $\mathcal{G}_0$ the set $\mathcal{G}$ after executing Line~\ref{algo_line:saturated_monomial_preprocess_G} and by $\mathcal{G}_m$ the Gröbner basis after the $m$-iteration of the outmost loop. Set $I_m = \langle \mathcal{G}_m \rangle$.
	
	First, note that the elements inserted into $\mathcal{G}$ are contained in $(I:(z_1\cdots z_n)^\infty)$ and are not divisible by any monomials. Furthermore, they are $w$-homogeneous since NF and spoly preseve homogeneity. Consequently, $\mathcal{G}_m$ satisfies the assumption of Proposition~\ref{proposition:saturated_monomial} with respect to the ordering $\;>_m$. As no element of $\mathcal{G}_m$ is divisible by any monomial, it follows that $\mathcal{G}_m$ is saturated with respect to $z_m$. In particular, $(I_{m-1} : (z_m)^\infty) \subseteq I_m$. Appendix~\ref{appendix:ideal_quotients} states that saturations preserve inclusion, so that $I\subseteq I_0$ together with $(I_{m-1} : (z_m)^\infty) \subseteq I_m$ implies that
	$$(I:(z_1\cdots z_n)^\infty) = (\dots((I:(z_1)^\infty):(z_2)^\infty):\dots : (z_n)^\infty) \subseteq I_n$$
	by a simple induction. It follows that $\langle \mathcal{G}_m \rangle = I_m = (I:(z_1\cdots z_n)^\infty)$.
\end{proof}

Now we are able to compute all orbit cones $\Omega_\ideal^{(k)}$ of full dimension $k$ by Algorithm~\ref{algo:compute_orbit_cones}. Its correctness is a straightforward conclusion from  Proposition~\ref{prop:aface_orbit_cone_correspondence} and~\ref{prop:aface_equivalence}.

\begin{algorithm}
	\caption{Computing all full dimensional orbit cones}
	\label{algo:compute_orbit_cones}
	
	\KwIn{$\ideal$, $Q$}
	\KwOut{All orbit cones of $\Omega_\ideal^{(k)}$ dimension $k$}
	\BlankLine
	$\Omega \leftarrow \emptyset$\;
	\For{$\gamma_0\preceq \gamma$ with $\dim(Q(\gamma_0)) = k$}{
		$I \leftarrow \ideal_{\gamma_0}$\;
		$I_\text{sat} \leftarrow (I:(\prod_{e_i\in\gamma_0} x_i)^\infty)$%
			\Comment*[r]{by Algorithm~\ref{algo:saturated_monomial}}
		\If{$I_\text{sat} = \field[\mathbf{x}_{\gamma_0}]$}{
			$\Omega \leftarrow \Omega \cup \{Q(\gamma_0)\}$\;
		}
	}
	\Return $\Omega$\;
\end{algorithm}

\section{Traversing the GIT fan}

%The traversal yields all nodes in this graph and thus a full description of the GIT fan.
% Warum reicht es, voll-dim Kegel GIT Cones zu betrachten? (Lemma 2.5 aus git-fan_computing)

%\todo{orbits mit p enthalten git cone} (für Kodierung) % Proposition: GIT cone is the intersection of all orbit cones containing it.

% Formalen Teil aus Kap. 4 übernehmen (Teil <e>)
% Nachbarschaftsalgorithmus


\section{Exploiting symmetry}

%Def. Symmetry-group
% a-face Invarianz
%\todo{Referenz: S wirkt auf OrbitCones} - und damit auf GIT-Cones nach Lemma "GIT cone is intersection..."
%Moving Cone invariant under symmetry group
%Formaler Teil zu GITFAN traversal aus Kap. 4
% Beweis zur Korrektheit des Nachbarschaftsalgorithmus

\begin{algorithm}
	\caption{Computing all neighbours of an GIT cone orbit}
	\label{algo:git_cone_orbitneighbours}
	
	\KwIn{a GIT cone orbit $\O\in\faktor{\Lambda(\mathfrak{a},Q)(k)}{\mathcal{S}}$}
	\KwOut{All GIT cone orbits $\O_\mathcal{N}\in\faktor{\Lambda(\mathfrak{a},Q)(k)}{\mathcal{S}}$ such that $\{\O, \O_\mathcal{N}\}\in E_\mathcal{S}$}
	\BlankLine
	$\mathcal{N} \leftarrow \emptyset$\;
	Choose $\lambda$ such that $\O = \mathcal{S}\lambda$\;
	\For{$\mu$ such that $\{\lambda,\mu\}\in E_{\langle e \rangle}$}{
		$\mathcal{N}\leftarrow \mathcal{N} \cup \{\mathcal{S}\mu\}$\;
	}
	\Return $\mathcal{N}$\;
\end{algorithm}

\section{Counterxample: Removing nominimal orbit cones}